# registrationMachine.ts ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ state-–º–∞—à–∏–Ω—ã

–ú–∞—à–∏–Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–≥–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `xstate`. –û–Ω–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –Ω–∏–º–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

---

## –°—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`welcome`)
2. –í—ã–±–æ—Ä —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞ (`transfer`)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (`postTransferCheck`)
4. –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é (`invitationPrompt`)
5. –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (`accommodation`)
6. –í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π (`activities`)
7. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (`summary`)
8. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (`completed`)

---

### üîÑ –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```markdown
| –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ     | –°–æ–±—ã—Ç–∏–µ                 | –°–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ       | –£—Å–ª–æ–≤–∏–µ                              |
|-----------------------|--------------------------|----------------------------|---------------------------------------|
| `welcome`             | `START_REGISTRATION`     | `transfer`                 | ‚Äî                                     |
| `transfer`            | `SELECT_TRANSFER`        | `postTransferCheck`        | ‚Äî                                     |
| `transfer`            | `GO_BACK`                | `welcome`                  | ‚Äî                                     |
| `postTransferCheck`   | *(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)*        | `invitationPrompt`         | –µ—Å–ª–∏ `invitationId` –µ—Å—Ç—å              |
| `postTransferCheck`   | *(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)*        | `accommodation`            | –µ—Å–ª–∏ `invitationId` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç       |
| `invitationPrompt`    | `ACCEPT_INVITATION`      | `activities`               | ‚Äî                                     |
| `invitationPrompt`    | `REJECT_INVITATION`      | `accommodation`            | ‚Äî                                     |
| `accommodation`       | `SELECT_ACCOMMODATION`   | `activities`               | ‚Äî                                     |
| `accommodation`       | `GO_BACK`                | `transfer`                 | ‚Äî                                     |
| `activities`          | `SELECT_ACTIVITIES`      | `summary`                  | ‚Äî                                     |
| `activities`          | `GO_BACK`                | `accommodation`            | –µ—Å–ª–∏ `invitationId` –Ω–µ—Ç               |
| `activities`          | `GO_BACK`                | `invitationPrompt`         | –µ—Å–ª–∏ `invitationId` –µ—Å—Ç—å              |
| `summary`             | `COMPLETE_REGISTRATION`  | `completed`                | ‚Äî                                     |
| `summary`             | `GO_BACK`                | `activities`               | ‚Äî                                     |
| `completed`           | `RESTART`                | `welcome`                  | ‚Äî                                     |
```
### –°–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–≥–∏–∫–µ

- `welcome`: —Å—Ç–∞—Ä—Ç, –∫–Ω–æ–ø–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `transfer`: –≤—ã–±–æ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–ª–∏ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä)
- `postTransferCheck`: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
- `invitationPrompt`: —Å–æ–≥–ª–∞—Å–∏–µ/–æ—Ç–∫–∞–∑ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ
- `accommodation`: –≤—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
- `activities`: –≤—ã–±–æ—Ä –¥–æ 2 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π, —É—á—ë—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π
- `summary`: —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- `completed`: —É—Å–ø–µ—Ö + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `registrationMachine`

```ts
createMachine({
  id: 'registration',
  initial: 'welcome',
  context: { ... },
  types: { ... },
  states: { ... }
})
```

### `id`
–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞—à–∏–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ DevTools.  
–ü—Ä–∏–º–µ—Ä: `'registration'`.

### `initial`
–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –º–∞—à–∏–Ω–∞.  
–ü—Ä–∏–º–µ—Ä: `'welcome'`.

### `context`
–û–±—ä–µ–∫—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏.  
–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ: `data` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, `invitationId`, `error`.

### `types`
–†–∞–∑–¥–µ–ª –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ TypeScript).  
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é `context` –∏ `event`.

---

## –°–æ—Å—Ç–æ—è–Ω–∏—è (`states`)

–ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç:
- –∫–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –æ–Ω–æ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å (`on`)
- –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ (`entry`, `exit`)
- –Ω—É–∂–Ω–æ –ª–∏ —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ (`always`)

### `on`
–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π.

```ts
on: {
  EVENT_NAME: {
    target: 'nextState',
    actions: [...] // –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  }
}
```

- `target` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø–µ—Ä–µ—Ö–æ–¥
- `actions` ‚Äî –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)

### `actions`
–û–ø–∏—Å—ã–≤–∞—é—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ.  
–°–∞–º–∞—è —á–∞—Å—Ç–∞—è ‚Äî `assign`, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç `context`.

```ts
actions: assign(({ context, event }) => ({
  data: { ...context.data, transfer: event.transfer }
}))
```

### `always`
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –±–µ–∑ —Å–æ–±—ã—Ç–∏—è.  
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ `context`.

```ts
always: [
  { target: 'invitationPrompt', guard: ({ context }) => !!context.invitationId },
  { target: 'accommodation' }
]
```

### `guard`
–£—Å–ª–æ–≤–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–∑—Ä–µ—à—ë–Ω –ø–µ—Ä–µ—Ö–æ–¥.  
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –∏–ª–∏ `false`:

```ts
guard: ({ context }) => context.data.transfer?.type === 'organized'
```

---

## –§–∞–π–ª
–ú–∞—à–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ [`src/machines/registrationMachine.ts`](../machines/registrationMachine.ts)
